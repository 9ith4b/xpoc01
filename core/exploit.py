from abc import ABC, abstractmethod
import logging
import requests


requests.packages.urllib3.disable_warnings()
logging.basicConfig(format='%(asctime)s - %(levelname)-8s:: %(message)s', level=logging.INFO)

class ErrorResult:
    status_code = 1000
    content     = b'error'
    text        = 'error'

class ExploitStatus:
    SUCCESS = 1000
    FAILED  = 1001

class HttpClient:
    headers = {
        'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.93 Safari/537.360',
    }

    def __init__(self, url):
        self.url = url
        self.sess = requests.Session()

    def request(self, method, uri, *args, **kwargs):
        try:
            kwargs.setdefault('headers', self.headers)
            kwargs.setdefault('verify', False)
            kwargs.setdefault('timeout', (8.0, 60.0))
            return self.sess.request(method, self.url+uri, *args, **kwargs)
        except requests.exceptions.ReadTimeout:
            logging.error("{:<30s} : Access network timeout".format(self.url))
        except requests.exceptions.ConnectionError:
            logging.error("{:<30s} : An error occurred while connecting to the network".format(self.url))
        except:
            logging.error("{:<30s} : Network connection error".format(self.url))
        return ErrorResult

    def requestlargedata(self, method, uri, *args, **kwargs):
        try:
            kwargs.setdefault('headers', self.headers)
            kwargs.setdefault('verify', False)
            kwargs.setdefault('stream', True)
            return self.sess.request(method, self.url+uri, *args, **kwargs)
        except requests.exceptions.ReadTimeout:
            logging.error("{:<30s} : Access network timeout".format(self.url))
        except requests.exceptions.ConnectionError:
            logging.error("{:<30s} : An error occurred while connecting to the network".format(self.url))
        except:
            logging.error("{:<30s} : Network connection error".format(self.url))
        return ErrorResult
    

RED     = '\033[1;91m'
BLUE    = '\033[1;94m'
GREEN   = '\033[1;32m'
ENDC    = '\033[0m'

level_color = {'error': RED, 'info': BLUE}

class Exploit(ABC):
    def log(self, msg, level):
        level = level.lower()
        getattr(logging, level)(level_color[level] + '{:<30s} : {}'.format(self.url, msg) + ENDC)
        return
    
    @abstractmethod
    def upload(self):
        pass

    @abstractmethod
    def attack(self, cmd):
        pass

    @abstractmethod
    def clean(self):
        pass
